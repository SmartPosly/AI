<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Integration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            background: #007cba;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #005a87;
        }

        .result {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            white-space: pre-wrap;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Test API Integration</h1>

        <div class="section">
            <h2>Test Registration API</h2>
            <form id="testForm">
                <input type="text" id="name" placeholder="Name" value="أحمد محمد" required>
                <input type="email" id="email" placeholder="Email" value="ahmed@example.com" required>
                <input type="tel" id="phone" placeholder="Phone (09X XXXXXXX)" value="0913555150" required>
                <select id="experience">
                    <option value="beginner">Beginner</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="advanced">Advanced</option>
                </select>
                <textarea id="notes" placeholder="Notes"></textarea>
                <button type="submit">Test Registration</button>
            </form>
            <div id="registerResult" class="result"></div>
        </div>

        <div class="section">
            <h2>Test Users API</h2>
            <button onclick="testUsersAPI()">Fetch Users</button>
            <button onclick="testUsersAPINoCache()">Fetch Users (No Cache)</button>
            <div id="usersResult" class="result"></div>
        </div>
    </div>

    <script>
        // Test registration
        document.getElementById('testForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                experience: document.getElementById('experience').value,
                interests: ['prompting', 'coding'],
                hearAbout: 'Test',
                notes: document.getElementById('notes').value
            };

            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                document.getElementById('registerResult').textContent =
                    `Status: ${response.status}\nResponse: ${JSON.stringify(result, null, 2)}`;

                if (result.success) {
                    document.getElementById('testForm').reset();
                }
            } catch (error) {
                document.getElementById('registerResult').textContent = `Error: ${error.message}`;
            }
        });

        // Test users API
        async function testUsersAPI() {
            try {
                const response = await fetch('/api/users');
                const result = await response.json();
                document.getElementById('usersResult').textContent =
                    `Status: ${response.status}\nTotal Users: ${result.length}\nLast User: ${JSON.stringify(result[result.length - 1], null, 2)}`;
            } catch (error) {
                document.getElementById('usersResult').textContent = `Error: ${error.message}`;
            }
        }

        // Test users API with no cache
        async function testUsersAPINoCache() {
            try {
                const response = await fetch('/api/users', {
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                const result = await response.json();
                document.getElementById('usersResult').textContent =
                    `Status: ${response.status} (No Cache)\nTotal Users: ${result.length}\nLast User: ${JSON.stringify(result[result.length - 1], null, 2)}`;
            } catch (error) {
                document.getElementById('usersResult').textContent = `Error: ${error.message}`;
            }
        }
    </script>
</body>

</html>